{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Check-In y Check-Out -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Check-In/Check-Out del Día</h2>
        </div>
        <input type="date" id="selected_date" value="{{ selected_date }}" class="form-field input">
        
        <!-- Check-In -->
        <div class="table-container">
            <h3 class="text-lg font-semibold mb-2">Check-In</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Habitación</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Llegada</th>
                            <th>Salida</th>
                            <th>Personas</th>
                            <th>Resto</th>
                            <th>Check</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reserva in checkin %}
                        <tr ondblclick="loadReservaDetail('{{ reserva.id }}')">
                            <td>{{ reserva.nhabitacion.numero }}</td>
                            <td>{{ reserva.nombre }}</td>
                            <td>{{ reserva.apellido }}</td>
                            <td>{{ reserva.fecha_ingreso }}</td>
                            <td>{{ reserva.fecha_egreso }}</td>
                            <td>{{ reserva.personas }}</td>
                            <td>{{ reserva.resto_formatted }}</td>
                            <td><input type="checkbox"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Check-Out -->
        <div class="table-container mt-4">
            <h3 class="text-lg font-semibold mb-2">Check-Out</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Habitación</th>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Llegada</th>
                            <th>Salida</th>
                            <th>Personas</th>
                            <th>Resto</th>
                            <th>Check</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reserva in checkout %}
                        <tr ondblclick="loadReservaDetail('{{ reserva.id }}')">
                            <td>{{ reserva.nhabitacion.numero }}</td>
                            <td>{{ reserva.nombre }}</td>
                            <td>{{ reserva.apellido }}</td>
                            <td>{{ reserva.fecha_ingreso }}</td>
                            <td>{{ reserva.fecha_egreso }}</td>
                            <td>{{ reserva.personas }}</td>
                            <td>{{ reserva.resto_formatted }}</td>
                            <td><input type="checkbox"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Mapa de habitaciones -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Mapa de Habitaciones</h2>
        </div>
        <div class="habitaciones-grid">
            {% for habitacion in estado_habitaciones %}
                <div class="habitacion {% if habitacion.ocupada %}ocupada{% else %}desocupada{% endif %}">
                    <span>{{ habitacion.numero }}<br>({{ habitacion.tipo }})</span>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

  <!-- Información adicional -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Lista de últimas reservas -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Últimas Reservas</h2>
        </div>
        <ul class="space-y-2">
            {% for reserva in reservas %}
                <li class="p-2 hover:bg-gray-50 rounded cursor-pointer" onclick="loadReservaDetail('{{ reserva.id }}')">
                    {{ reserva.nombre }} - {{ reserva.fecha_ingreso }}
                </li>
            {% endfor %}
        </ul>
    </div>
    
    <!-- Cotización del dólar -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Cotización del Dólar</h2>
        </div>
        <p class="text-lg">
            La cotización actual del dólar es: 
            <span class="font-bold text-green-600">{{ dollar_rate }}</span>
        </p>
    </div>
</div>

<!-- Popup para detalles de reserva -->
<input type="checkbox" id="popup-toggle" style="display: none;">
<label for="popup-toggle" class="popup-background"></label>
<div id="reserva-popup" class="popup">
    <label for="popup-toggle" class="close">&times;</label>
    <h2>Detalle de Reserva</h2>
    <div id="reserva-detail-content"></div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('selected_date').addEventListener('change', function() {
        window.location.href = '?selected_date=' + this.value;
    });

    function loadReservaDetail(reservaId) {
        fetch(`/reservas/detalle/${reservaId}/`)
            .then(response => response.text())
            .then(data => {
                document.getElementById('reserva-detail-content').innerHTML = data;
                document.getElementById('popup-toggle').checked = true;
            });
    }
</script>
{% endblock %}
